{"pageProps":{"post":{"title":"アニメーションを使いまわすための「motion+Slot」戦略","date":"2022-07-01","slug":"motion-slot","content":"<p data-line=\"1\" class=\"code-line\"><a href=\"https://stitches.dev/\" rel=\"noreferrer noopener nofollow\" target=\"_blank\">https://stitches.dev/</a><a href=\"https://stitches.dev/\" style=\"display:none\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://stitches.dev/</a></p>\n<h2 id=\"%E6%A6%82%E8%A6%81\" data-line=\"3\" class=\"code-line\"><a class=\"header-anchor-link\" href=\"#%E6%A6%82%E8%A6%81\" aria-hidden=\"true\"></a> 概要</h2>\n<p data-line=\"5\" class=\"code-line\">Framer MotionをReact Slotで運用すると、アニメーションの再利用性が飛躍的に向上します。</p>\n<h3 id=\"react-slot\" data-line=\"7\" class=\"code-line\"><a class=\"header-anchor-link\" href=\"#react-slot\" aria-hidden=\"true\"></a> React Slot</h3>\n<p data-line=\"9\" class=\"code-line\"><a href=\"https://www.radix-ui.com/docs/primitives/utilities/slot\" rel=\"noreferrer noopener nofollow\" target=\"_blank\">https://www.radix-ui.com/docs/primitives/utilities/slot</a><a href=\"https://www.radix-ui.com/docs/primitives/utilities/slot\" style=\"display:none\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.radix-ui.com/docs/primitives/utilities/slot</a></p>\n<p data-line=\"11\" class=\"code-line\"><code>Slot</code>は子コンポーネントにpropsを渡す役割を持ちます。</p>\n<p data-line=\"13\" class=\"code-line\">これが</p>\n<div class=\"code-block-container\"><pre class=\"language-tsx\"><code class=\"language-tsx code-line\" data-line=\"15\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Slot</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>red<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">&lt;AnyComponent /&gt;</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Slot</span></span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div><p data-line=\"19\" class=\"code-line\">実質的にこうなります。</p>\n<div class=\"code-block-container\"><pre class=\"language-tsx\"><code class=\"language-tsx code-line\" data-line=\"21\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AnyComponent</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>red<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n</code></pre></div><p data-line=\"25\" class=\"code-line\"><code>Slot</code>本体は消えるものの、propsを介して任意のコンポーネントに機能を与えられるという点が重要です。余分な<code>div</code>を生成することはありません。</p>\n<p data-line=\"27\" class=\"code-line\">詳しくは<a href=\"https://zenn.dev/subt/articles/b6aa48ccb0c884\" target=\"_blank\">こちら</a>を参照ください。</p>\n<h3 id=\"framer-motion\" data-line=\"30\" class=\"code-line\"><a class=\"header-anchor-link\" href=\"#framer-motion\" aria-hidden=\"true\"></a> Framer Motion</h3>\n<p data-line=\"32\" class=\"code-line\"><a href=\"https://www.framer.com/motion\" rel=\"noreferrer noopener nofollow\" target=\"_blank\">https://www.framer.com/motion</a><a href=\"https://www.framer.com/motion\" style=\"display:none\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.framer.com/motion</a></p>\n<p data-line=\"34\" class=\"code-line\"><a href=\"https://www.framer.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Framer</a>が提供しているアニメーションライブラリです。</p>\n<p data-line=\"36\" class=\"code-line\">どんなアニメーションでも、基本的に<strong>propsだけ</strong>で完結してしまうのが特徴です。</p>\n<div class=\"code-block-container\"><pre class=\"language-tsx\"><code class=\"language-tsx code-line\" data-line=\"38\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>motion.div</span>\n  <span class=\"token attr-name\">drag</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>x<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">dragConstraints</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> left<span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> right<span class=\"token operator\">:</span> <span class=\"token number\">100</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n  <span class=\"token attr-name\">whileHover</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> scale<span class=\"token operator\">:</span> <span class=\"token number\">1.1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n  <span class=\"token attr-name\">whileTap</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> scale<span class=\"token operator\">:</span> <span class=\"token number\">0.9</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n<span class=\"token punctuation\">/&gt;</span></span>\n</code></pre></div><p data-line=\"47\" class=\"code-line\">カスタムコンポーネントは<code>motion</code>関数に渡してアニメーションをつけます。</p>\n<div class=\"code-block-container\"><pre class=\"language-tsx\"><code class=\"language-tsx code-line\" data-line=\"49\"><span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">MotionComponent</span> <span class=\"token operator\">=</span> <span class=\"token function\">motion</span><span class=\"token punctuation\">(</span><span class=\"token maybe-class-name\">Component</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token spread operator\">...</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MotionComponent</span></span> <span class=\"token attr-name\">animate</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> scale<span class=\"token operator\">:</span> <span class=\"token number\">0.5</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/&gt;</span></span>\n</code></pre></div><h2 id=\"motion%2Bslot%E3%81%A7%E4%BD%95%E3%81%8C%E3%81%A7%E3%81%8D%E3%82%8B%EF%BC%9F\" data-line=\"55\" class=\"code-line\"><a class=\"header-anchor-link\" href=\"#motion%2Bslot%E3%81%A7%E4%BD%95%E3%81%8C%E3%81%A7%E3%81%8D%E3%82%8B%EF%BC%9F\" aria-hidden=\"true\"></a> <code>motion</code>+<code>Slot</code>で何ができる？</h2>\n<p data-line=\"57\" class=\"code-line\"><code>motion</code>と<code>Slot</code>を組み合わせて<code>motion(Slot)</code>を作ります。すると、</p>\n<p data-line=\"59\" class=\"code-line\"><code>motion</code>が提供してくれる手軽でリッチなアニメーション機能をそのまま、提供元を完全に隠蔽して提供する</p>\n<p data-line=\"61\" class=\"code-line\">ことができるようになります。</p>\n<p data-line=\"63\" class=\"code-line\">何を言っているのか、私もよくわからないので具体例に移りましょう。</p>\n<h2 id=\"%E5%85%B7%E4%BD%93%E4%BE%8B\" data-line=\"65\" class=\"code-line\"><a class=\"header-anchor-link\" href=\"#%E5%85%B7%E4%BD%93%E4%BE%8B\" aria-hidden=\"true\"></a> 具体例</h2>\n<p data-line=\"67\" class=\"code-line\"><code>motion(Slot)</code>を使って、みんな大好き「<a href=\"https://qiita.com/yuneco/items/24a209cb14661b8a7a20\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ふわっ</a>」が手軽に実装できるようにしましょう。</p>\n<h3 id=\"%E5%AE%9F%E8%A3%85\" data-line=\"70\" class=\"code-line\"><a class=\"header-anchor-link\" href=\"#%E5%AE%9F%E8%A3%85\" aria-hidden=\"true\"></a> 実装</h3>\n<div class=\"code-block-container\"><pre class=\"language-tsx\"><code class=\"language-tsx code-line\" data-line=\"72\"><span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">React</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">Slot</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@radix-ui/react-slot'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> motion <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">'framer-motion'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">ContentLayout</span> <span class=\"token operator\">=</span> <span class=\"token function\">motion</span><span class=\"token punctuation\">(</span><span class=\"token maybe-class-name\">Slot</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Custom</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  y<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  once<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n  amount<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  duration<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> defaultCustom<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Custom</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  y<span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n  once<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  amount<span class=\"token operator\">:</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">,</span>\n  duration<span class=\"token operator\">:</span> <span class=\"token number\">0.6</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>custom<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Custom</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">ComponentProps</span></span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> <span class=\"token maybe-class-name\">ContentLayout</span><span class=\"token operator\">&gt;</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> y<span class=\"token punctuation\">,</span> once<span class=\"token punctuation\">,</span> amount<span class=\"token punctuation\">,</span> duration <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token spread operator\">...</span>defaultCustom<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>custom <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    initial<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      opacity<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      y<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    whileInView<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      opacity<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      y<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    viewport<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      once<span class=\"token punctuation\">,</span>\n      amount<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    transition<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      duration<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Props</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  children<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">ReactNode</span></span><span class=\"token punctuation\">;</span>\n  custom<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Custom</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">Enter</span> <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">forwardRef</span><span class=\"token operator\">&lt;</span>\n  <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">ElementRef</span></span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> <span class=\"token maybe-class-name\">ContentLayout</span><span class=\"token operator\">&gt;</span><span class=\"token punctuation\">,</span>\n  <span class=\"token maybe-class-name\">Props</span>\n<span class=\"token operator\">&gt;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children<span class=\"token punctuation\">,</span> custom <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> forwardedRef<span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=&gt;</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ContentLayout</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token spread operator\">...</span><span class=\"token method function property-access\">config</span><span class=\"token punctuation\">(</span>custom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>forwardedRef<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n    </span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ContentLayout</span></span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token maybe-class-name\">Enter</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">displayName</span> <span class=\"token operator\">=</span> <span class=\"token string\">'Enter'</span><span class=\"token punctuation\">;</span>\n</code></pre></div><h3 id=\"%E4%BD%BF%E3%81%84%E6%96%B9\" data-line=\"132\" class=\"code-line\"><a class=\"header-anchor-link\" href=\"#%E4%BD%BF%E3%81%84%E6%96%B9\" aria-hidden=\"true\"></a> 使い方</h3>\n<p data-line=\"134\" class=\"code-line\">たったこれだけで、<code>h1</code>がふわっと入場します。</p>\n<div class=\"code-block-container\"><pre class=\"language-tsx\"><code class=\"language-tsx code-line\" data-line=\"136\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Enter</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">Hello CodeSandbox</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Enter</span></span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre></div><p data-line=\"142\" class=\"code-line\">CodeSandboxに使用例を上げました。</p>\n<span class=\"embed-block embed-codesandbox\"><iframe src=\"https://codesandbox.io/embed/nifty-fast-gs8cjy?fontsize=14&amp;hidenavigation=1&amp;theme=dark\" style=\"width:100%;height:500px;border:none;overflow:hidden\" allow=\"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking\" loading=\"lazy\" sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"></iframe></span>\n<p data-line=\"146\" class=\"code-line\">ぜひ、別窓で開いて余計な<code>div</code>が生成されていないことをお確かめください。</p>\n<h3 id=\"%E6%B3%A8%E6%84%8F%E7%82%B9\" data-line=\"148\" class=\"code-line\"><a class=\"header-anchor-link\" href=\"#%E6%B3%A8%E6%84%8F%E7%82%B9\" aria-hidden=\"true\"></a> 注意点</h3>\n<p data-line=\"150\" class=\"code-line\"><code>motion</code>は内部的にrefを使用します。なので、対象のコンポーネントがカスタムコンポーネントである場合、正しくrefをフォワーディングしている必要があります。</p>\n<p data-line=\"152\" class=\"code-line\">refや<code>forwardRef</code>をご存知ない方は、調べてみてください。きっと、<code>Slot</code>や<code>motion</code>に比べてはるかに多くの記事がヒットするでしょう。</p>\n<h2 id=\"%E3%81%BE%E3%81%A8%E3%82%81\" data-line=\"154\" class=\"code-line\"><a class=\"header-anchor-link\" href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden=\"true\"></a> まとめ</h2>\n<p data-line=\"156\" class=\"code-line\"><code>motion(Slot)</code>で再利用性バツグンのアニメーションコンポーネントを作ることができました。</p>\n<p data-line=\"158\" class=\"code-line\">実装自体<code>motion</code>の軽い延長に過ぎないので、簡単にオリジナルのアニメーションコンポーネントが作れると思います。是非お試しください。</p>\n<p data-line=\"160\" class=\"code-line\">私も色々実装してみて、またの機会に紹介したいと思います。</p>\n","ogImage":{"url":"/assets/blog/dynamic-routing/cover.jpg"},"coverImage":"/assets/blog/dynamic-routing/cover.jpg","excerpt":"Framer MotionのmotionコンポーネントとRadix UIのユーティリティのコンポーネントSlotを組み合わせることで、アニメーションの再利用性を爆上げします。","tags":["React","RadixUI","FramerMotion"]}},"__N_SSG":true}